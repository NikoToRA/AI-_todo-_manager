# AI駆動タスク管理システム - 要件定義

## システム概要
Google Apps Script（GAS）をコアとし、Gemini APIによるAI分析を統合したハイブリッドタスク管理システム

## 🎯 主要要件

### 1. 繰り返しカレンダーイベントの日付別処理
**要件ID**: REQ-001  
**優先度**: 最高  
**内容**: 
- 同じ会議でも異なる日付で個別タスク作成
- 毎日の定例会議が適切に個別のタスクとして管理される
- タスクタイトル形式: `会議名 (YYYY-MM-DD)`

### 2. 重複防止スキーム
**要件ID**: REQ-002  
**優先度**: 最高  
**内容**:
- **第1段階**: ProcessedTracker による日付別処理済み管理
- **第2段階**: DuplicateChecker による類似タスクチェック  
- 同じoriginal_eventでも異なる日付なら重複ではない

### 3. カレンダー連携
**要件ID**: REQ-003  
**優先度**: 高  
**内容**:
- 全カレンダーからイベントを自動抽出
- イベント詳細情報の活用（場所、参加者、説明）
- 処理済みマーキング（PropertiesService管理、イベント自体は変更しない）

### 4. Notion統合
**要件ID**: REQ-004  
**優先度**: 高  
**内容**:
- タスクデータベースへの自動登録
- 実行サマリーの作成・管理
- 既存タスクとの重複チェック

### 5. Gmail連携
**要件ID**: REQ-005  
**優先度**: 中  
**内容**:
- 未読メール・アクションアイテムの自動検出
- メール内容からのタスク生成
- 期日抽出と優先度判定

### 6. AI分析機能
**要件ID**: REQ-006  
**優先度**: 中  
**内容**:
- Gemini APIによる意味的類似性判断
- 重複タスク統合提案
- コンテキスト理解による優先度判定

## 🏗️ アーキテクチャ要件

### 技術仕様
- **ES5互換性**: Google Apps Scriptの制約に対応
- **エラーハンドリング**: 個別エラー時の処理継続
- **パフォーマンス**: GAS 6分制限内での実行完了

### 必須ファイル構成
```
CodeDeploy.gs              - メインエントリーポイント
config.gs                  - 設定管理
NotionClient.gs            - Notion API統合
TaskExtractorES5.gs        - タスク抽出エンジン
DuplicateCheckerES5.gs     - 重複チェック機能
ProcessedTrackerES5.gs     - 処理済み追跡（日付別管理）
Utils.gs                   - ユーティリティ関数
BasicTests.gs              - 基本テスト関数
```

## 🔄 プロセス仕様

### メイン処理フロー
1. **カレンダーイベント取得**
2. **ProcessedTracker**: 日付別処理済みチェック
3. **タスク生成**: 日付付きタイトルで生成
4. **DuplicateChecker**: 既存タスクとの重複チェック
5. **Notion登録**: 新規タスクのみ登録
6. **処理済みマーク**: PropertiesServiceに記録

### 日付別管理システム
- **ID生成**: `hash(タイトル + 日付 + 場所)`
- **PropertiesService**: 軽量データストレージ
- **カレンダー非変更**: 元イベントには触れない

## 📊 成功基準

### 機能要件
- [ ] 繰り返しイベントが日付別に個別タスク化される
- [ ] 同じ日付の同じイベントは重複処理されない
- [ ] 異なる日付の同じイベントは個別に処理される
- [ ] Notionタスクが適切に作成される

### 非機能要件
- [ ] 実行時間6分以内
- [ ] エラー時の適切な継続処理
- [ ] 設定値の適切な管理
- [ ] ログ出力による動作追跡

## 🎛️ 設定要件

### 必須設定
- `NOTION_TOKEN`: Notion統合トークン
- `NOTION_DATABASE_ID`: タスクデータベースID
- `GEMINI_API_KEY`: Gemini AI APIキー（オプション）

### オプション設定
- `ENABLE_AI_ANALYSIS`: AI分析機能の有効化（デフォルト: true）
- `ENABLE_GMAIL_ANALYSIS`: Gmail分析の有効化（デフォルト: true）
- `DATA_RANGE_DAYS`: データ取得範囲（デフォルト: 7日）

## 🚀 実行モード

### 手動実行
- `run()`: フル機能実行
- `runCalendarOnly()`: カレンダーのみ
- `runGmailOnly()`: Gmailのみ
- `runManualTest()`: テスト実行

### 自動実行
- `scheduledExecution()`: トリガー設定用関数
- 日次自動実行対応

## 🔧 保守要件

### ログ・監視
- 詳細な実行ログ出力
- システム状態確認機能(`checkSystemStatus()`)
- 緊急時復旧機能(`createEmergencyTask()`)

### データ管理
- 処理済みデータの定期クリーンアップ
- PropertiesServiceの容量管理（9KB制限対応）
- 古いデータの自動削除（30日保持）

---

**更新日**: 2024年8月11日  
**バージョン**: 1.0  
**ステータス**: 開発完了・テスト中